(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup_is-opened")}function n(e){e.classList.remove("popup_is-opened")}e.d({},{TW:()=>p,Tp:()=>l,m6:()=>L,y6:()=>_,_U:()=>b,ru:()=>S,dm:()=>s,mo:()=>f,wH:()=>h,vR:()=>m,p$:()=>v});var r={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"5487a251-bd52-4493-a6b1-e35331c9597d","Content-Type":"application/json"}};function o(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function c(e,n){var c=l.children[0].cloneNode(!0),a=c.querySelector(".card__image"),u=c.querySelector(".card__title"),i=c.querySelector(".card__like-button"),s=c.querySelector(".card__delete-button"),d=c.querySelector(".card__like-container"),p=c.querySelector(".card__like-count");return p||((p=document.createElement("span")).classList.add("card__like-count"),d.appendChild(p)),a.src=e.link,a.alt=e.name,u.textContent=e.name,p.textContent=e.likes.length,e.likes.some((function(e){return e._id===n}))&&i.classList.add("card__like-button_is-active"),i.addEventListener("click",(function(){var t,n=i.classList.contains("card__like-button_is-active");(n?(t=e._id,fetch("".concat(r.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:r.headers}).then(o)):function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:r.headers}).then(o)}(e._id)).then((function(e){i.classList.toggle("card__like-button_is-active",!n),p.textContent=e.likes.length})).catch((function(e){console.error("Ошибка при обновлении лайка:",e),alert("Не удалось обновить лайк")}))})),e.owner._id===n?s.addEventListener("click",(function(){var t;(t=e._id,fetch("".concat(r.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:r.headers}).then(o)).then((function(){c.remove()})).catch((function(e){console.error("Ошибка при удалении карточки:",e),alert("Не удалось удалить карточку")}))})):s.remove(),a.addEventListener("click",(function(){var n=_.querySelector(".popup__image"),r=_.querySelector(".popup__caption");n.src=e.link,n.alt=e.name,r.textContent=e.name,t(_)})),c}var a=document.querySelector(".profile__image");function u(e,t,n,r){var o=e.querySelector("#".concat(t.name,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}function i(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}var l=document.querySelector("#card-template").content,s=document.querySelector(".places__list"),d=document.querySelector(".popup_type_edit"),p=document.querySelector(".popup_type_new-card"),_=document.querySelector(".popup_type_image"),m=document.querySelector(".profile__title"),f=document.querySelector(".profile__description"),v=d.querySelector(".popup__input_type_name"),h=d.querySelector(".popup__input_type_description"),y=d.querySelector(".popup__form"),S=(y.querySelector(".popup__button"),document.querySelector(".popup__input_type_card-name")),b=document.querySelector(".popup__input_type_url"),q=p.querySelector(".popup__form"),k=document.querySelectorAll(".popup");k.forEach((function(e){return e.classList.add("popup_is-animated")}));var E,L=null,C=document.querySelector(".popup_type_edit-avatar"),g=C.querySelector(".popup__form"),x=C.querySelector(".popup__input_type_avatar-link"),U=document.querySelector(".profile__avatar-edit-button"),T=document.querySelector(".profile__image");fetch("".concat(r.baseUrl,"/users/me"),{headers:{authorization:r.headers.authorization}}).then(o).then((function(e){return m.textContent=e.name,f.textContent=e.about,T.style.backgroundImage="url(".concat(e.avatar,")"),L=e._id,fetch("".concat(r.baseUrl,"/cards"),{headers:{authorization:r.headers.authorization}}).then(o)})).then((function(e){e.forEach((function(e){var t=c(e,L);s.prepend(t)}))})).catch((function(e){return console.error("Ошибка при загрузке данных:",e)})),k.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target===e&&n(e)}))})),document.addEventListener("keydown",(function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&n(t)}})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){v.value=m.textContent,h.value=f.textContent,t(d)})),d.querySelector(".popup__close").addEventListener("click",(function(){n(d)})),document.querySelector(".profile__add-button").addEventListener("click",(function(){S.value=S.textContent,b.value=b.textContent,t(p)})),p.querySelector(".popup__close").addEventListener("click",(function(){n(p)})),_.querySelector(".popup__close").addEventListener("click",(function(){n(_)})),y.addEventListener("submit",(function(e){var t,c,a;e.preventDefault(),(t={name:v.value,about:h.value},c=t.name,a=t.about,fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:c,about:a})}).then(o)).then((function(e){m.textContent=e.name,f.textContent=e.about,n(profilePopup)})).catch((function(e){return console.error("Ошибка при обновлении профиля:",e)}))})),q.addEventListener("submit",(function(e){var t;e.preventDefault(),(t={name:S.value,link:b.value},fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify(t)}).then(o)).then((function(e){var t=c(e,L);s.prepend(t),n(p)})).catch((function(e){console.error("Ошибка при добавлении карточки:",e),alert("Не удалось добавить карточку")}))})),U.addEventListener("click",(function(){x.value="",t(C)})),C.querySelector(".popup__close").addEventListener("click",(function(){return n(C)})),g.addEventListener("submit",(function(e){var t;e.preventDefault(),(t=e.target.avatar.value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:t})}).then(o)).then((function(e){a.style.backgroundImage="url(".concat(e.avatar,")"),n(document.querySelector(".popup_type_edit-avatar"))})).catch((function(e){console.error("Ошибка при обновлении аватара:",e),alert("Не удалось обновить аватар. Убедитесь, что введена корректная ссылка.")}))})),E={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(E.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);i(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){(function(e,t,n){var r=t.value.trim();"link"!==t.name||function(e){try{return new URL(e),!0}catch(e){return!1}}(r)?"name"===t.name&&(r.length<2||r.length>40)?u(e,t,"Имя должно быть от 2 до 40 символов.",n):"description"===t.name&&(r.length<2||r.length>200)?u(e,t,"Описание должно быть от 2 до 200 символов.",n):"title"===t.name&&(r.length<2||r.length>30)?u(e,t,"Название должно быть от 2 до 30 символов.",n):t.validity.valid?function(e,t,n){var r=e.querySelector("#".concat(t.name,"-error"));t.classList.remove(n.inputErrorClass),r.textContent="",r.classList.remove(n.errorClass)}(e,t,n):u(e,t,t.validationMessage,n):u(e,t,"Введите корректную ссылку.",n)})(e,o,t),i(n,r,t)}))}))}(e,E)}))})();