(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup_is-opened")}function n(e){e.classList.remove("popup_is-opened")}e.d({},{Tp:()=>s,m6:()=>g,y6:()=>f,eE:()=>j});var o={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"5487a251-bd52-4493-a6b1-e35331c9597d","Content-Type":"application/json"}};function r(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function c(e){return fetch("".concat(o.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:o.headers}).then(r)}function a(e,n){var a=s.children[0].cloneNode(!0),u=a.querySelector(".card__image"),i=a.querySelector(".card__title"),l=a.querySelector(".card__like-button"),p=a.querySelector(".card__delete-button"),d=a.querySelector(".card__like-container"),_=a.querySelector(".card__like-count");_||((_=document.createElement("span")).classList.add("card__like-count"),d.appendChild(_)),u.src=e.link,u.alt=e.name,i.textContent=e.name,_.textContent=e.likes.length,e.likes.some((function(e){return e._id===n}))&&l.classList.add("card__like-button_is-active"),l.addEventListener("click",(function(){var t,n=l.classList.contains("card__like-button_is-active");(n?(t=e._id,fetch("".concat(o.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:o.headers}).then(r)):function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:o.headers}).then(r)}(e._id)).then((function(e){l.classList.toggle("card__like-button_is-active",!n),_.textContent=e.likes.length})).catch((function(e){console.error("Ошибка при обновлении лайка:",e),alert("Не удалось обновить лайк")}))}));var m=a.querySelector(".card__delete-button");return e.owner._id===n?m.addEventListener("click",(function(){j(a,e._id)})):m.style.display="none",e.owner._id===n?p.addEventListener("click",(function(){c(e._id).then((function(){a.remove()})).catch((function(e){console.error("Ошибка при удалении карточки:",e),alert("Не удалось удалить карточку")}))})):p.remove(),u.addEventListener("click",(function(){var n=f.querySelector(".popup__image"),o=f.querySelector(".popup__caption");n.src=e.link,n.alt=e.name,o.textContent=e.name,t(f)})),a}function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";e.textContent=t?"Сохранение...":n}function i(e,t,n,o){var r=e.querySelector("#".concat(t.name,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}function l(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}document.querySelector(".profile__image");var s=document.querySelector("#card-template").content,p=document.querySelector(".places__list"),d=document.querySelector(".popup_type_edit"),_=document.querySelector(".popup_type_new-card"),f=document.querySelector(".popup_type_image"),m=document.querySelector(".profile__title"),y=document.querySelector(".profile__description"),v=d.querySelector(".popup__input_type_name"),h=d.querySelector(".popup__input_type_description"),S=d.querySelector(".popup__form"),q=(S.querySelector(".popup__button"),document.querySelector(".popup__input_type_card-name")),b=document.querySelector(".popup__input_type_url"),E=_.querySelector(".popup__form"),k=document.querySelectorAll(".popup");k.forEach((function(e){return e.classList.add("popup_is-animated")}));var L,g=null,C=document.querySelector(".popup_type_edit-avatar"),x=C.querySelector(".popup__form"),U=C.querySelector(".popup__input_type_avatar-link"),T=document.querySelector(".profile__avatar-edit-button"),w=document.querySelector(".profile__image"),A=document.querySelector(".popup_type_confirm-delete"),O=A.querySelector("form"),P=O.querySelector(".popup__button"),D=null;function j(e,n){D={element:e,id:n},console.log("я открылся"),t(A)}fetch("".concat(o.baseUrl,"/users/me"),{headers:{authorization:o.headers.authorization}}).then(r).then((function(e){return m.textContent=e.name,y.textContent=e.about,w.style.backgroundImage="url(".concat(e.avatar,")"),g=e._id,fetch("".concat(o.baseUrl,"/cards"),{headers:{authorization:o.headers.authorization}}).then(r)})).then((function(e){e.forEach((function(e){var t=a(e,g);p.prepend(t)}))})).catch((function(e){return console.error("Ошибка при загрузке данных:",e)})),k.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target===e&&n(e)}))})),document.addEventListener("keydown",(function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&n(t)}})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){v.value=m.textContent,h.value=y.textContent,t(d)})),d.querySelector(".popup__close").addEventListener("click",(function(){n(d)})),document.querySelector(".profile__add-button").addEventListener("click",(function(){q.value=q.textContent,b.value=b.textContent,t(_)})),_.querySelector(".popup__close").addEventListener("click",(function(){n(_)})),f.querySelector(".popup__close").addEventListener("click",(function(){n(f)})),S.addEventListener("submit",(function(e){e.preventDefault();var t=e.target,c=t.querySelector(".popup__button"),a=t.name.value,i=t.description.value;u(c,!0),function(e){var t=e.name,n=e.about;return fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:t,about:n})}).then(r)}({name:a,about:i}).then((function(e){document.querySelector(".profile__title").textContent=e.name,document.querySelector(".profile__description").textContent=e.about,n(t.closest(".popup"))})).catch((function(e){console.error("Ошибка обновления профиля:",e)})).finally((function(){u(c,!1)}))})),E.addEventListener("submit",(function(e){e.preventDefault();var t,c=e.target,i=c.querySelector(".popup__button"),l=c.title.value,s=c.link.value;u(i,!0),(t={name:l,link:s},fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify(t)}).then(r)).then((function(e){var t=a(e,g);document.querySelector(".places__list").prepend(t),n(c.closest(".popup"))})).catch((function(e){console.error("Ошибка добавления карточки:",e)})).finally((function(){u(i,!1)}))})),T.addEventListener("click",(function(){U.value="",t(C)})),C.querySelector(".popup__close").addEventListener("click",(function(){return n(C)})),x.addEventListener("submit",(function(e){e.preventDefault();var t,c=e.target,a=c.querySelector(".popup__button"),i=c.avatar.value;u(a,!0),(t={avatar:i},fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:t})}).then(r)).then((function(e){document.querySelector(".profile__image").style.backgroundImage="url(".concat(e.avatar,")"),n(c.closest(".popup"))})).catch((function(e){console.error("Ошибка обновления аватара:",e)})).finally((function(){u(a,!1)}))})),O.addEventListener("submit",(function(e){e.preventDefault(),P.textContent="Удаление...",c(D.id).then((function(){D.element.remove(),n(A)})).catch((function(e){console.error("Ошибка удаления карточки:",e)})).finally((function(){P.textContent="Да",D=null}))})),A.querySelector(".popup__close").addEventListener("click",(function(){return n(A)})),L={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(L.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);l(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){(function(e,t,n){var o=t.value.trim();"link"!==t.name||function(e){try{return new URL(e),!0}catch(e){return!1}}(o)?"name"===t.name&&(o.length<2||o.length>40)?i(e,t,"Имя должно быть от 2 до 40 символов.",n):"description"===t.name&&(o.length<2||o.length>200)?i(e,t,"Описание должно быть от 2 до 200 символов.",n):"title"===t.name&&(o.length<2||o.length>30)?i(e,t,"Название должно быть от 2 до 30 символов.",n):t.validity.valid?function(e,t,n){var o=e.querySelector("#".concat(t.name,"-error"));t.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}(e,t,n):i(e,t,t.validationMessage,n):i(e,t,"Введите корректную ссылку.",n)})(e,r,t),l(n,o,t)}))}))}(e,L)}))})();