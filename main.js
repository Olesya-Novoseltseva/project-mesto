(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup_is-opened")}function n(e){e.classList.remove("popup_is-opened")}e.d({},{Tp:()=>s,m6:()=>C,y6:()=>f,eE:()=>w,Bd:()=>j});var o={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"5487a251-bd52-4493-a6b1-e35331c9597d","Content-Type":"application/json"}};function r(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function c(e,n){var c=s.children[0].cloneNode(!0),a=c.querySelector(".card__image"),u=c.querySelector(".card__title"),i=c.querySelector(".card__like-button"),l=(c.querySelector(".card__delete-button"),c.querySelector(".card__like-container")),p=c.querySelector(".card__like-count");p||((p=document.createElement("span")).classList.add("card__like-count"),l.appendChild(p)),a.src=e.link,a.alt=e.name,u.textContent=e.name,p.textContent=e.likes.length,e.likes.some((function(e){return e._id===n}))&&i.classList.add("card__like-button_is-active"),i.addEventListener("click",(function(){var t,n=i.classList.contains("card__like-button_is-active");(n?(t=e._id,fetch("".concat(o.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:o.headers}).then(r)):function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:o.headers}).then(r)}(e._id)).then((function(e){i.classList.toggle("card__like-button_is-active",!n),p.textContent=e.likes.length})).catch((function(e){console.error("Ошибка при обновлении лайка:",e),alert("Не удалось обновить лайк")}))}));var d=c.querySelector(".card__delete-button");return e.owner._id===n?d.addEventListener("click",(function(){w(c,e._id)})):d.style.display="none",a.addEventListener("click",(function(){var n=f.querySelector(".popup__image"),o=f.querySelector(".popup__caption");n.src=e.link,n.alt=e.name,o.textContent=e.name,t(f)})),c}var a=document.querySelector(".profile__image");function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";e.textContent=t?"Сохранение...":n}function i(e,t,n,o){var r=e.querySelector("#".concat(t.name,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}function l(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}var s=document.querySelector("#card-template").content,p=document.querySelector(".places__list"),d=document.querySelector(".popup_type_edit"),_=document.querySelector(".popup_type_new-card"),f=document.querySelector(".popup_type_image"),m=document.querySelector(".profile__title"),y=document.querySelector(".profile__description"),v=d.querySelector(".popup__input_type_name"),h=d.querySelector(".popup__input_type_description"),S=d.querySelector(".popup__form"),q=(S.querySelector(".popup__button"),document.querySelector(".popup__input_type_card-name")),b=document.querySelector(".popup__input_type_url"),L=_.querySelector(".popup__form"),k=document.querySelectorAll(".popup");k.forEach((function(e){return e.classList.add("popup_is-animated")}));var C=null,E=document.querySelector(".popup_type_edit-avatar"),g=E.querySelector(".popup__form"),x=E.querySelector(".popup__input_type_avatar-link"),U=document.querySelector(".profile__avatar-edit-button"),B=document.querySelector(".profile__image"),T=document.querySelector(".popup_type_confirm-delete"),A=T.querySelector("form"),O=A.querySelector(".popup__button"),P=null;function w(e,n){P={element:e,id:n},t(T)}fetch("".concat(o.baseUrl,"/users/me"),{headers:{authorization:o.headers.authorization}}).then(r).then((function(e){return m.textContent=e.name,y.textContent=e.about,B.style.backgroundImage="url(".concat(e.avatar,")"),C=e._id,fetch("".concat(o.baseUrl,"/cards"),{headers:{authorization:o.headers.authorization}}).then(r)})).then((function(e){e.forEach((function(e){var t=c(e,C);p.prepend(t)}))})).catch((function(e){return console.error("Ошибка при загрузке данных:",e)})),k.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target===e&&n(e)}))})),document.addEventListener("keydown",(function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&n(t)}})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){v.value=m.textContent,h.value=y.textContent,t(d)})),d.querySelector(".popup__close").addEventListener("click",(function(){n(d)})),document.querySelector(".profile__add-button").addEventListener("click",(function(){q.value=q.textContent,b.value=b.textContent,t(_)})),_.querySelector(".popup__close").addEventListener("click",(function(){n(_)})),f.querySelector(".popup__close").addEventListener("click",(function(){n(f)})),S.addEventListener("submit",(function(e){e.preventDefault();var t=e.target,c=t.querySelector(".popup__button"),a=t.name.value,i=t.description.value;u(c,!0),function(e){var t=e.name,n=e.about;return fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:t,about:n})}).then(r)}({name:a,about:i}).then((function(e){document.querySelector(".profile__title").textContent=e.name,document.querySelector(".profile__description").textContent=e.about,c.classList.add(j.inactiveButtonClass),n(t.closest(".popup"))})).catch((function(e){console.error("Ошибка обновления профиля:",e)})).finally((function(){u(c,!1)}))})),L.addEventListener("submit",(function(e){e.preventDefault();var t,a=e.target,i=a.querySelector(".popup__button"),l=a.title.value,s=a.link.value;u(i,!0),(t={name:l,link:s},fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify(t)}).then(r)).then((function(e){var t=c(e,C);document.querySelector(".places__list").prepend(t),i.classList.add(j.inactiveButtonClass),n(a.closest(".popup"))})).catch((function(e){console.error("Ошибка добавления карточки:",e)})).finally((function(){u(i,!1)}))})),U.addEventListener("click",(function(){x.value="",t(E)})),E.querySelector(".popup__close").addEventListener("click",(function(){return n(E)})),g.addEventListener("submit",(function(e){e.preventDefault();var t=e.target,c=t.querySelector(".popup__input_type_avatar-link"),u=t.querySelector(".popup__button"),i=c.value.trim();u.textContent="Сохранение...",function(e){return fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:e})}).then(r)}(i).then((function(e){a.style.backgroundImage="url(".concat(e.avatar,")"),submitButton.classList.add(j.inactiveButtonClass),n(t.closest(".popup"))})).catch((function(e){console.error("Ошибка при обновлении аватара:",e)})).finally((function(){u.textContent="Сохранить"}))})),A.addEventListener("submit",(function(e){var t;e.preventDefault(),O.textContent="Удаление...",(t=P.id,fetch("".concat(o.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:o.headers}).then(r)).then((function(){P.element.remove(),n(T)})).catch((function(e){console.error("Ошибка удаления карточки:",e)})).finally((function(){O.textContent="Да",P=null}))})),T.querySelector(".popup__close").addEventListener("click",(function(){return n(T)}));var D,j={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};D=j,Array.from(document.querySelectorAll(D.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);l(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){(function(e,t,n){var o=t.value.trim();"link"!==t.name||function(e){try{return new URL(e),!0}catch(e){return!1}}(o)?"name"===t.name&&(o.length<2||o.length>40)?i(e,t,"Имя должно быть от 2 до 40 символов.",n):"description"===t.name&&(o.length<2||o.length>200)?i(e,t,"Описание должно быть от 2 до 200 символов.",n):"title"===t.name&&(o.length<2||o.length>30)?i(e,t,"Название должно быть от 2 до 30 символов.",n):t.validity.valid?function(e,t,n){var o=e.querySelector("#".concat(t.name,"-error"));t.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}(e,t,n):i(e,t,t.validationMessage,n):i(e,t,"Введите корректную ссылку.",n)})(e,r,t),l(n,o,t)}))}))}(e,D)}))})();